{% extends '__base__.html' %} 

{% block title %}日志{% endblock %} 

{% block beforehead %}

<script>
	function initVM(data) {
		vmtable = new Vue({
			el: '#vmtable',
			data: {
				blogs: data.blogs,
				page: data.page
			},
			methods: {
				edit_blog: function (blog) {
					location.assign('/manage/blogs/edit?id=' + blog.id);
				},
				delete_blog: function (blog) {
					if (confirm('确认要删除“' + blog.name + '”吗？删除后不可恢复！')) {
						postJSON('/api/blogs/' + blog.id + '/delete', function (err, r) {
							if (err) {
								return alert(err.message || err.error || err);
							}
							refresh();
						});
					}
				}
			}
    });
    // awesome.js 中的 component 定义不能用？
    Vue.component('pagination', {
        props: ['page', 'pageindex'],
        template: `<ul class="uk-pagination uk-flex-center">
        <li v-if="! page.has_previous" class="uk-disabled"><a href="#"><span uk-pagination-previous></span></a></li>
        <li v-else><a @click="gotoPage(pageindex-1)" href="#0"><span uk-pagination-previous></span></a></li>
        <li class="uk-active"><a href="#"><span v-text="pageindex"></span></a></li>
        <li v-if="! page.has_next" class="uk-disabled"><a href="#"><span uk-pagination-next></span></a></li>
        <li v-else><a @click="gotoPage(pageindex+1)" href="#0"><span uk-pagination-next></span></a></li>
    </ul>`
    });
    vmpage = new Vue({
			el: '#vmpage',
			data: {
        page: data.page,
        pageindex: '{{ page_index }}'
			}
		});
		// $('#vm').show();
	}
	$(function () {
		getJSON('/api/blogs', {
			page: '{{ page_index }}'
		}, function (err, results) {
			if (err) {
				return fatal(err);
			}
			$('#loading').hide();
			initVM(results);
		});
	});
</script> 
{% endblock %} 

{% block content %}

<div class="uk-width-1-1 uk-margin-top">
	<div class="uk-panel uk-panel-box">
		<ul class="uk-breadcrumb">
			<li>
				<a href="/manage/comments">评论</a>
			</li>
			<li class="uk-active">
				<span>日志</span>
			</li>
			<li>
				<a href="/manage/users">用户</a>
			</li>
		</ul>
	</div>
</div>

<div id="error" class="uk-width-1-1">
</div>

<div id="loading" class="uk-width-1-1 uk-text-center">
	<span><span :uk-icon="'icon: clock'"></span> 正在加载...</span>
</div>

<!-- <a href="/manage/blogs/create" class="uk-button uk-button-primary"><span :uk-icon="'icon: pencil'"></span> 新日志</a> -->

<div id="vmtable" class="uk-width-1-1">
	<table class="uk-table uk-table-hover">
		<thead>
			<tr>
				<th class="uk-width-1-2">标题 / 摘要</th>
				<th class="uk-width-1-5">作者</th>
				<th class="uk-width-1-5">创建时间</th>
				<th class="uk-width-1-10">操作</th>
			</tr>
		</thead>
		<tbody>
			<tr v-for="blog in blogs">
				<td>
					<a target="_blank" :href="'/blog/'+blog.id" v-text="blog.name"></a>
				</td>
				<td>
					<a target="_blank" :href="'/user/'+blog.user_id" v-text="blog.user_name"></a>
				</td>
				<td>
					<span v-text="blog.created_at.toDateTime()"></span>
				</td>
				<td>
					<a href="#0" @click="edit_blog(blog)">
						<span :uk-icon="'icon: file-edit'"></span>
						<a href="#0" @click="delete_blog(blog)">
							<span :uk-icon="'icon: trash'"></span>
				</td>
			</tr>
		</tbody>
	</table>

</div>

<div id="vmpage" class="uk-width-1-1">
    <pagination :page="page" :pageindex="pageindex"></pagination>
</div>

{% endblock %}